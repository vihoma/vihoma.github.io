<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
 <head>
  <title>[untitled]</title>
  <style>
/*
 * A stylesheet designed to be used with the HTML output of the
 * Perl module Text::Highlight::Vim.
 *
 * This is designed to make the highlighting look like the default gvim
 * colour scheme, with 'background=light'.
 *
 * Geoff Richards (qef@laxan.com)
 *
 * This CSS file (light.css) is public domain.  Do what you want with it.
 * That doesn't mean that HTML with this CSS in is public domain.
 */

body { color: black; background: white none }

A:link { color: #00F; background: white none }
A:visited { color: #909; background: white none }
A:hover { color: #F00; background: white none }
A:active { color: #F00; background: white none }

.synComment    { color: #0000FF }
.synConstant   { color: #FF00FF }
.synIdentifier { color: #008B8B }
.synStatement  { color: #A52A2A ; font-weight: bold }
.synPreProc    { color: #A020F0 }
.synType       { color: #2E8B57 ; font-weight: bold }
.synSpecial    { color: #6A5ACD }
.synUnderlined { color: #000000 ; text-decoration: underline }
.synError      { color: #FFFFFF ; background: #FF0000 none }
.synTodo       { color: #0000FF ; background: #FFFF00 none }
</style>
 </head>
 <body>

<pre><span class="synPreProc">#!/usr/bin/env perl</span>

<span class="synStatement">use strict</span>;
<span class="synStatement">use warnings</span>;
<span class="synStatement">use </span>JSON;

<span class="synStatement">my</span> <span class="synIdentifier">$string</span>;
<span class="synStatement">my</span> <span class="synIdentifier">$func</span> = <span class="synIdentifier">$ARGV[</span><span class="synConstant">0</span><span class="synIdentifier">]</span>;
<span class="synStatement">my</span> <span class="synIdentifier">$class</span> = <span class="synIdentifier">$ARGV[</span><span class="synConstant">1</span><span class="synIdentifier">]</span>;

main();

<span class="synStatement">sub </span><span class="synIdentifier">main </span>{
  <span class="synStatement">my</span> <span class="synIdentifier">$file</span> = select_file();
  <span class="synStatement">open</span>(<span class="synStatement">my</span> <span class="synIdentifier">$fh</span>, <span class="synConstant">&quot;&lt;&quot;</span>, <span class="synIdentifier">$file</span>) <span class="synStatement">or</span> <span class="synStatement">die</span> <span class="synConstant">&quot;Can't open HearthStone stats JSON-file: </span><span class="synIdentifier">$file</span>
<span class="synConstant">  Error: </span><span class="synSpecial">\&quot;</span><span class="synIdentifier">$!</span><span class="synSpecial">\&quot;\n</span><span class="synConstant">&quot;</span>;
  <span class="synStatement">while</span> (&lt;<span class="synIdentifier">$fh</span>&gt;) {
    <span class="synIdentifier">$string</span> .= <span class="synIdentifier">$_</span>;
  }
  <span class="synStatement">close</span>(<span class="synIdentifier">$fh</span>);
  
  <span class="synStatement">if</span> (<span class="synIdentifier">$string</span>) {
    <span class="synStatement">if</span> (is_class(<span class="synIdentifier">$class</span>) &amp;&amp; <span class="synIdentifier">$class</span> <span class="synStatement">ne</span> <span class="synConstant">&quot;friends&quot;</span>) {
      parse_practice();
      <span class="synStatement">return</span> <span class="synConstant">1</span>;
    } <span class="synStatement">elsif</span> (<span class="synIdentifier">$class</span> = <span class="synConstant">&quot;friends&quot;</span>) {
      parse_friends();
      <span class="synStatement">return</span> <span class="synConstant">1</span>;
    } <span class="synStatement">else</span> {
      <span class="synStatement">print</span> <span class="synConstant">&quot;</span><span class="synIdentifier">$class</span><span class="synConstant"> is not a HearthStone Hero class or 'friends'!</span><span class="synSpecial">\n</span><span class="synConstant">&quot;</span>;
      usage();
      <span class="synStatement">return</span> <span class="synConstant">0</span>;
    }
  } <span class="synStatement">else</span> {
    <span class="synStatement">print</span> <span class="synConstant">&quot;File </span><span class="synIdentifier">$file</span><span class="synConstant"> is empty!&quot;</span>;
    usage();
    <span class="synStatement">return</span> <span class="synConstant">0</span>;
  }
}

<span class="synStatement">sub </span><span class="synIdentifier">select_file </span>{
  <span class="synStatement">my</span> <span class="synIdentifier">$input</span>;
  <span class="synStatement">if</span> (<span class="synIdentifier">$func</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;friends&quot;</span>) {
    <span class="synIdentifier">$input</span> = <span class="synConstant">&quot;</span><span class="synIdentifier">$ENV{</span><span class="synConstant">'HOME'</span><span class="synIdentifier">}</span><span class="synConstant">/etc/hs-stats/friends.json&quot;</span>;
    <span class="synStatement">return</span> <span class="synIdentifier">$input</span>;
  } <span class="synStatement">elsif</span> (is_class(<span class="synIdentifier">$class</span>) &amp;&amp; <span class="synIdentifier">$func</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;normal&quot;</span>) {
    <span class="synIdentifier">$input</span> = <span class="synConstant">&quot;</span><span class="synIdentifier">$ENV{</span><span class="synConstant">'HOME'</span><span class="synIdentifier">}</span><span class="synConstant">/etc/hs-stats/practice_normal.json&quot;</span>;
    <span class="synStatement">return</span> <span class="synIdentifier">$input</span>;
  } <span class="synStatement">elsif</span> (is_class(<span class="synIdentifier">$class</span>) &amp;&amp; <span class="synIdentifier">$func</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;expert&quot;</span>) {
    <span class="synIdentifier">$input</span> = <span class="synConstant">&quot;</span><span class="synIdentifier">$ENV{</span><span class="synConstant">'HOME'</span><span class="synIdentifier">}</span><span class="synConstant">/etc/hs-stats/practice_expert.json&quot;</span>;
    <span class="synStatement">return</span> <span class="synIdentifier">$input</span>;
  } <span class="synStatement">else</span> {
    usage();
    <span class="synStatement">return</span> <span class="synConstant">0</span>;
  }
}

<span class="synStatement">sub </span><span class="synIdentifier">is_class </span>{
  <span class="synStatement">my</span> <span class="synIdentifier">$test</span> = <span class="synStatement">shift</span>;
  <span class="synStatement">if</span> (<span class="synIdentifier">$test</span>) {
    <span class="synStatement">return</span> <span class="synConstant">1</span> <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;Warlock&quot;</span>);
    <span class="synStatement">return</span> <span class="synConstant">1</span> <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;Paladin&quot;</span>);
    <span class="synStatement">return</span> <span class="synConstant">1</span> <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;Mage&quot;</span>);
    <span class="synStatement">return</span> <span class="synConstant">1</span> <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;Shaman&quot;</span>);
    <span class="synStatement">return</span> <span class="synConstant">1</span> <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;Rogue&quot;</span>);
    <span class="synStatement">return</span> <span class="synConstant">1</span> <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;Druid&quot;</span>);
    <span class="synStatement">return</span> <span class="synConstant">1</span> <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;Hunter&quot;</span>);
    <span class="synStatement">return</span> <span class="synConstant">1</span> <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;Priest&quot;</span>);
    <span class="synStatement">return</span> <span class="synConstant">1</span> <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;Warrior&quot;</span>);
    <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;warlock&quot;</span>) { <span class="synIdentifier">$class</span> = <span class="synConstant">&quot;Warlock&quot;</span>; <span class="synStatement">return</span> <span class="synConstant">1</span>; }
    <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;paladin&quot;</span>) { <span class="synIdentifier">$class</span> = <span class="synConstant">&quot;Paladin&quot;</span>; <span class="synStatement">return</span> <span class="synConstant">1</span>; }
    <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;mage&quot;</span>) { <span class="synIdentifier">$class</span> = <span class="synConstant">&quot;Mage&quot;</span>; <span class="synStatement">return</span> <span class="synConstant">1</span>; }
    <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;shaman&quot;</span>) { <span class="synIdentifier">$class</span> = <span class="synConstant">&quot;Shaman&quot;</span>; <span class="synStatement">return</span> <span class="synConstant">1</span>; }
    <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;rogue&quot;</span>) { <span class="synIdentifier">$class</span> = <span class="synConstant">&quot;Rogue&quot;</span>; <span class="synStatement">return</span> <span class="synConstant">1</span>; }
    <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;druid&quot;</span>) { <span class="synIdentifier">$class</span> = <span class="synConstant">&quot;Druid&quot;</span>; <span class="synStatement">return</span> <span class="synConstant">1</span>; }
    <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;hunter&quot;</span>) { <span class="synIdentifier">$class</span> = <span class="synConstant">&quot;Hunter&quot;</span>; <span class="synStatement">return</span> <span class="synConstant">1</span>; }
    <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;priest&quot;</span>) { <span class="synIdentifier">$class</span> = <span class="synConstant">&quot;Priest&quot;</span>; <span class="synStatement">return</span> <span class="synConstant">1</span>; }
    <span class="synStatement">if</span> (<span class="synIdentifier">$test</span> <span class="synStatement">eq</span> <span class="synConstant">&quot;warrior&quot;</span>) { <span class="synIdentifier">$class</span> = <span class="synConstant">&quot;Warrior&quot;</span>; <span class="synStatement">return</span> <span class="synConstant">1</span>; }
  }

  <span class="synStatement">return</span> <span class="synConstant">0</span>;
}

<span class="synStatement">sub </span><span class="synIdentifier">parse_practice </span>{
  <span class="synStatement">my</span> <span class="synIdentifier">$parsed</span> = decode_json(<span class="synIdentifier">$string</span>);
  <span class="synStatement">my</span> <span class="synIdentifier">@players</span> = <span class="synIdentifier">$parsed-&gt;{</span><span class="synConstant">'wins'</span><span class="synIdentifier">}-&gt;{</span><span class="synConstant">&quot;</span><span class="synIdentifier">$class</span><span class="synConstant">&quot;</span><span class="synIdentifier">}</span>;
  
  <span class="synStatement">for</span> (<span class="synStatement">my</span> <span class="synIdentifier">$i</span> = <span class="synConstant">0</span>; <span class="synIdentifier">$i</span> &lt; <span class="synConstant">9</span>; <span class="synIdentifier">$i</span>++) {
    <span class="synStatement">print</span> <span class="synConstant">&quot;</span><span class="synIdentifier">$players[</span><span class="synConstant">0</span><span class="synIdentifier">][$i]</span><span class="synSpecial">\n</span><span class="synConstant">&quot;</span> <span class="synStatement">if</span>(<span class="synIdentifier">$players[</span><span class="synConstant">0</span><span class="synIdentifier">][$i]</span>);
  }

  <span class="synStatement">return</span> <span class="synConstant">1</span>;
}

<span class="synStatement">sub </span><span class="synIdentifier">parse_friends </span>{
  <span class="synStatement">my</span> <span class="synIdentifier">$parsed</span> = decode_json(<span class="synIdentifier">$string</span>);
  <span class="synStatement">my</span> <span class="synIdentifier">$wins</span> = <span class="synIdentifier">$parsed-&gt;{</span><span class="synConstant">'wins'</span><span class="synIdentifier">}</span>;
  
  <span class="synStatement">foreach</span> <span class="synStatement">my</span> <span class="synIdentifier">$res</span> (<span class="synIdentifier">%{$wins}</span>) {
    <span class="synStatement">if</span> (<span class="synIdentifier">$res</span> =~ <span class="synStatement">/</span><span class="synConstant">^</span><span class="synSpecial">\d</span><span class="synConstant">$</span><span class="synStatement">/</span>) {
      <span class="synStatement">print</span> <span class="synConstant">&quot;</span><span class="synIdentifier">$res</span><span class="synSpecial">\n</span><span class="synConstant">&quot;</span>;
    } <span class="synStatement">else</span> {
      <span class="synStatement">print</span> <span class="synConstant">&quot;</span><span class="synIdentifier">$res</span><span class="synConstant"> : &quot;</span>;
    }
  }

  <span class="synStatement">return</span> <span class="synConstant">1</span>;
}

<span class="synStatement">sub </span><span class="synIdentifier">usage </span>{
  <span class="synStatement">print</span> <span class="synConstant">&quot;Usage: hs-stats &lt;mode&gt; &lt;class&gt;</span><span class="synSpecial">\n</span><span class="synConstant">or:</span><span class="synSpecial">\n</span><span class="synConstant">hs-stats &lt;mode&gt;&quot;</span>;
  <span class="synStatement">print</span> <span class="synConstant">&quot;Class can be one of HearthStone Hero classes or 'friends'</span><span class="synSpecial">\n</span><span class="synConstant">&quot;</span>;
  <span class="synStatement">return</span> <span class="synConstant">1</span>;
}
</pre>

 </body>
</html>
